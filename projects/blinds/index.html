<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Blinds for Homekit / Web - tillepille</title>
  <meta name="description" content="For a long time we already had an automation for our blinds at home in the livingroom but at least twice a year, when there&rsquo;s the change from summer to wintertime or the other way round, these things suck.
Where&rsquo;s the manual? I already did this a dozen times, can&rsquo;t be so difficult&hellip;
Turns out it is difficult. I believe these things are made to never be touched again.">
  <meta name="author" content="Tim Schrumpf"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "tillepille",
    
    "url": "https:\/\/tillepille.github.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/tillepille.github.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/tillepille.github.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/tillepille.github.io\/projects\/blinds\/",
          "name": "Blinds for homekit \/ web"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Tim Schrumpf"
  },
  "headline": "Blinds for Homekit \/ Web",
  "description" : "For a long time we already had an automation for our blinds at home in the livingroom but at least twice a year, when there\x26rsquo;s the change from summer to wintertime or the other way round, these things suck.\nWhere\x26rsquo;s the manual? I already did this a dozen times, can\x26rsquo;t be so difficult\x26hellip;\nTurns out it is difficult. I believe these things are made to never be touched again.",
  "inLanguage" : "en",
  "wordCount":  724 ,
  "datePublished" : "2018-11-14T22:08:47",
  "dateModified" : "2018-11-14T22:08:47",
  "image" : "https:\/\/tillepille.github.io\/img\/avatar-icon.png",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/tillepille.github.io\/projects\/blinds\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/tillepille.github.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/tillepille.github.io\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Blinds for Homekit / Web" />
<meta property="og:description" content="For a long time we already had an automation for our blinds at home in the livingroom but at least twice a year, when there&rsquo;s the change from summer to wintertime or the other way round, these things suck.
Where&rsquo;s the manual? I already did this a dozen times, can&rsquo;t be so difficult&hellip;
Turns out it is difficult. I believe these things are made to never be touched again.">
<meta property="og:image" content="https://tillepille.github.io/img/avatar-icon.png" />
<meta property="og:url" content="https://tillepille.github.io/projects/blinds/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="tillepille" />

  <meta name="twitter:title" content="Blinds for Homekit / Web" />
  <meta name="twitter:description" content="For a long time we already had an automation for our blinds at home in the livingroom but at least twice a year, when there&rsquo;s the change from summer to wintertime or the other way round, these â€¦">
  <meta name="twitter:image" content="https://tillepille.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@timschrumpf" />
  <meta name="twitter:creator" content="@timschrumpf" />
  <link href='https://tillepille.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.55.6" />
  <link rel="alternate" href="https://tillepille.github.io/index.xml" type="application/rss+xml" title="tillepille"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://tillepille.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tillepille.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://tillepille.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tillepille.github.io">tillepille</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/posts/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/about">About</a>
            </li>
          
        
          
            <li>
              <a title="Projects" href="/projects/">Projects</a>
            </li>
          
        
          
            <li>
              <a title="Impressum" href="/impressum">Impressum</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="tillepille" href="https://tillepille.github.io">
            <img class="avatar-img" src="https://tillepille.github.io/img/avatar-icon.png" alt="tillepille" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="projects-heading">
              
                <h1>Blinds for Homekit / Web</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p>For a long time we already had an automation for our blinds at home in the livingroom but at least twice a year, when there&rsquo;s the change from summer to wintertime or the other way round, these things <strong>suck</strong>.</p>

<p><em>Where&rsquo;s the manual? I already did this a dozen times, can&rsquo;t be so difficult&hellip;</em></p>

<p>Turns out it is difficult. I believe these things are made to never be touched again.</p>

<p>So far so good.
Since the broadening of home automation solutions, especially HomeKit there was the need to add other devices without an official certification.
For this is <a href="https://github.com/nfarina/homebridge">homebridge</a>, but after a quick&rsquo;n&rsquo;dirty search for a plug and play solution i didn&rsquo;t find anything very useful. Next step, order a Raspberry Pi zero, a double relay, read somewhere about how easy it is to use gpio with Python.</p>

<h2 id="update-2018-11-29">Update 2018-11-29 :</h2>

<p>I just moved the Frontend into the main Repository so it&rsquo;s much more transparent to see, whats going on there for everyone.</p>

<h3 id="first-steps">First Steps</h3>

<p>So Python is an interpreted language, wich is very nice for hacking like this because, whenever you save a change to the file, your system gets restarted.</p>

<p>My first approach was a flask boilerplate with some routes so you get an understanding on how this works there.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/status&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">status</span><span class="p">()</span>
	<span class="k">return</span> <span class="s2">&#34;something&#34;</span></code></pre></div>
<p>So the second step is how to make things blink.</p>

<p>Nice thing about the common relays you get on ebay or amazon or somewhere else, they all have a LED for the activated relay.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">LED</span>
<span class="n">pinNumber</span> <span class="o">=</span> <span class="mi">27</span>
<span class="n">roll</span> <span class="o">=</span> <span class="n">LED</span><span class="p">(</span><span class="n">pinNumber</span><span class="p">)</span>
<span class="n">roll</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
<span class="c1"># is now on...</span></code></pre></div>
<p>So if you&rsquo;re a Sherlock you can do things like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/turn-on&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">turnOn</span><span class="p">()</span>
	<span class="n">roll</span><span class="o">.</span><span class="n">on</span><span class="p">()</span>
    <span class="k">return</span> <span class="s2">&#34;your LED is now on! aka something is moving!&#34;</span></code></pre></div>
<h3 id="fine-tuning">Fine Tuning</h3>

<p>Sometimes when is really hot outside or the sun is shining on your glossy screen, you don&rsquo;t want to close the blinds completely but rather just 50%.</p>

<p>So for this case, the only known method to me is to make this over a time factor. Movement should be pretty constant, so moving 20% should require double the time of 10% moving. But because there is some difference between the upward and downward movement, you need two factors to calculate the time.</p>

<p>So this is how i made it work:</p>

<ol>
<li><code>travel = int(abs(currentHeight - desiredHeight))</code></li>
<li><code>sleep(travel * config.upFactor)</code> or <code>config.downFactor</code></li>
</ol>

<p>But because this isn&rsquo;t the completly perfect method, i reset the <code>currentHeight</code> whenever I want it 0 or 100.</p>

<p>Lastly, Flask runs threaded on default, means for every new request it spins up a new thread. Since the HomeKit drag options makes a lot of calls when you move your finger slowly, i disabled this feature with <code>app.run(debug=False, host='0.0.0.0', threaded=False)</code>. Flask also runs at localhost per default, so change that, too.</p>

<h2 id="frontend">Frontend</h2>

<p>Because I already had the vue-cli installed, i started with the minimal boilerplate which ships with it, deleted everything unnecessary and hacked a mobile-optimized button layout together. I see there some potential to make it more usable but does the work for now..</p>

<h2 id="recap-what-i-learned">Recap: What I learned</h2>

<p>My biggest gain with this little project is that python is really easy to pick up, build a prototype and play around with it. I definetly have no idea how Python performs in a production enviroment where it counts on speed and security. But as long as i treat my home network as a secure enviroment, this shouldn&rsquo;t become a problem.</p>

<p>Second, Flask is a nice framework, easy to understand when you&rsquo;d like to do something real quick. So a recommendation for a project like this.</p>

<p>Because there are a lot of people who aren&rsquo;t using Apple&rsquo;s HomeKit I build my first <a href="https://vuejs.org">Vue.js</a> Frontend for this case where you have two big buttons and a slider for the percental settings (Link below).</p>

<p>I played around with Vue for another project but it was a rather complex thing to start with it. I created a project with vue-cli and deleted everything i didn&rsquo;t need, maybe not the best approach for such a simple thing, but I really like the approach to have your HTML, JS and CSS all in just one file. You can split up your Frontend in different submodules wich is very neat in my opinion!</p>

<p><strong>The exported project embedded in the main repository, ready to use!</strong></p>

<h2 id="links">Links</h2>

<p><a href="https://github.com/tillepille/rolladensteuerung">My repository</a></p>

<p><a href="http://flask.pocoo.org">Flask</a></p>

<p><a href="https://github.com/tillepille/rolladensteuerung-frontend">My Frontend</a></p>


        

        

        
          

          
        
      </article>

      
        <ul class="pager blog-pager">
          
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:tim@tillepille.io" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/tillepille" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://gitlab.com/tillepille" title="GitLab">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/timschrumpf" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/tim-schrumpf-616121183" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.instagram.com/tillepille" title="Instagram">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-instagram fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://telegram.me/bole821" title="Telegram">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-telegram fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="tillepille.io">Tim Schrumpf</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2019
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://tillepille.github.io">tillepille</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.55.6</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://tillepille.github.io/js/main.js"></script>
<script src="https://tillepille.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://tillepille.github.io/js/load-photoswipe.js"></script>









    
  </body>
</html>

